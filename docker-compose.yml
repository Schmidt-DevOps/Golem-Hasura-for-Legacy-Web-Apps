version: '3.8'

services:
  nginx:
    image: devilbox/nginx-mainline
    ports:
      - "8100:81"
    volumes:
      - ./web/php:/var/www/default/htdocs
      - ./conf/nginx.conf:/etc/httpd/vhost.d/default.conf
    environment:
      PHP_FPM_ENABLE: 1
      PHP_FPM_SERVER_ADDR: php
      PHP_FPM_SERVER_PORT: 9000
    networks:
      - app-network
    depends_on:
      - php
  # https://github.com/devilbox/docker-php-fpm-5.4
  php:
    image: devilbox/php-fpm:5.6-prod
    volumes:
      - ./web/php:/var/www/default/htdocs
    networks:
      - app-network
    depends_on:
      - postgres
  postgres:
    image: postgres:9-alpine
    ports:
      - "5432:5432"
    environment:
      POSTGRES_DB: ds2
      POSTGRES_USER: ds2
      POSTGRES_PASSWORD: ds2
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./initdb.d:/docker-entrypoint-initdb.d:ro
      - ./data_files:/data_files:ro
    networks:
      - app-network
    command: ["postgres", "-c", "log_statement=all"]

networks:
  app-network:
    driver: bridge

volumes:
  postgres_data:
